// script.js
document.addEventListener('DOMContentLoaded', () => {
    const birthdateInput = document.getElementById('birthdate');
    const submitButton = document.getElementById('submit-button');
    
    const inputSection = document.getElementById('input-section');
    const resultSection = document.getElementById('result-section');
    
    const loadingSpinner = document.getElementById('loading-spinner');
    const resultContent = document.getElementById('result-content');
    
    const specialMessageDiv = document.getElementById('special-message-20070101');
    const specialTextMainElement = document.getElementById('special-text-main');
    const specialQuoteTextElement = document.getElementById('special-quote-text');
    const emphasizedNandeyaElement = document.getElementById('emphasized-nandeya');
    const specialTextConclusionElement = document.getElementById('special-text-conclusion');

    const normalMessageDiv = document.getElementById('normal-message');
    const normalMessageTextElement = document.getElementById('message-text-element');
    
    const itemCategoryElement = document.getElementById('item-category-element');
    const itemNameElement = document.getElementById('item-name-element');
    const itemFortuneMessageElement = document.getElementById('item-fortune-message-element');
    const itemLinkElement = document.getElementById('item-link');
    const itemMainIconElement = document.querySelector('.item-main-icon'); // „Ç¢„Ç§„Ç≥„É≥Ë¶ÅÁ¥†„ÇíÂèñÂæó

    const backButton = document.getElementById('back-button');
    document.getElementById('current-year').textContent = new Date().getFullYear();

    const specialBirthdate = '2007-01-01';

    const specialMessages = {
        main: `‰ªäÂπ¥„ÄÅ„ÅÇ„Å™„Åü„ÅØÈ¶ôÂ∑ùÁúåÂÜÖ„ÅÆ„ÇÑ„ÇÑÂÅèÂ∑ÆÂÄ§„ÅÆ‰Ωé„ÅÑÂ§ßÂ≠¶„Å´ÈÄ≤Â≠¶„Åó„ÅüÂèØËÉΩÊÄß„ÅåÈ´ò„Åù„ÅÜ„Åß„Åô„ÄÇ„Åó„Åã„Åó„ÄÅ„Åù„Çå„Åå„ÅÇ„Å™„Åü„ÅÆÂÆüÂäõ„ÇíÊ∏¨„ÇãÂÖ®„Å¶„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„ÇÄ„Åó„Çç„ÄÅ„ÅÇ„Å™„Åü„ÅÆÊú¨È†ò„ÅØÂ≠¶Â§ñ„ÅßÁô∫ÊèÆ„Åï„Çå„ÇãÂπ¥„Åß„Åô„ÄÇ\nÁâπ„Å´„ÄÅÈ´òIQ„Ç≥„Éü„É•„Éã„ÉÜ„Ç£„Å®„ÅÆÁ∏Å„ÅåÂº∑„Åè„Å™„Çä„ÄÅ„ÄåËá™ÂàÜ„ÅÆËÑ≥„ÅÆËº™ÈÉ≠„Äç„ÇíÊé¢„ÇãÊé¢Ê±Ç„Å´Ê≤°È†≠„Åô„Çã„Åß„Åó„Çá„ÅÜ„ÄÇ„ÇÇ„Åó„Åã„Åô„Çã„Å®„ÄÅ„Åì„Çì„Å™Ë®ÄËëâ„Çí„Å©„Åì„Åã„Å´Ë®ò„Åó„Å¶„ÅÑ„Çã„Åã„ÇÇ„Åó„Çå„Åæ„Åõ„ÇìÔºö`,
        quote: `„ÄåÁõ∏ÂΩìÂÅèÂ∑ÆÂÄ§„ÅÆÈ´ò„ÅÑÈ´òÊ†°ÔºàË∫´„ÅÆ‰∏à„Å´Âêà„Å£„Å¶„Å™„ÅÑÔºâ„Å´ÈÄö„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ\n\nÈ´ò‰∏â„Å™„ÅÆ„Åß„Åô„ÅåÊú™„Å†„Å´„Ç¢„É´„Éï„Ç°„Éô„ÉÉ„Éà„ÅåË™≠„ÇÅ„Å™„ÅÑ„Åì„Å®„ÇÑadhd„Å£„ÅΩ„ÅÑ„Åì„Å®„Å´ÊÇ©„Çì„ÅßË¶™„Å´Âúü‰∏ãÂ∫ß„Åó„Å¶waisÂèó„Åë„Åï„Åõ„Å¶„ÇÇ„Çâ„ÅÑ„Åæ„Åó„Åü„ÄÇ\n\nÁü•Ë¶öÊé®ÁêÜ144\n\nË®ÄË™ûÁêÜËß£142\n\n„ÉØ„Éº„Ç≠„É≥„Ç∞„É°„É¢„É™130\n\nÂá¶ÁêÜÈÄüÂ∫¶84„Åß„Åó„Åü„ÄÇ\n\nÁ∑èÂêà„ÅØË¶ö„Åà„Å¶„Å™„ÅÑ„Åß„Åô„ÅåÂ§öÂàÜ139„Å®„Åã„Å†„Å£„Åü„ÅØ„Åö„Åß„Åô„ÄÇ\n\n„Ç¶„Ç£„Çπ„ÇØ„ÅÆÂπ¥ÈΩ¢„Å™„ÅÆ„Å´„Ç¶„Çß„Ç§„ÇπÂèó„Åë„Åï„Åõ„Çâ„Çå„Åü„ÄÇ`,
        conclusion: `‚îÄ‚îÄ„Åù„ÅÆÁü•ÊÄß„Å®ÈÅïÂíåÊÑü„ÅÆ„ÅØ„Åñ„Åæ„Åß„ÄÅ„ÅÇ„Å™„Åü„ÅØ„ÄåÊú¨Áâ©„ÅÆËá™Â∑±ÁêÜËß£„Äç„ÇíÊé¥„Åø„Åã„Åë„Å¶„ÅÑ„Åæ„Åô„ÄÇÁÑ¶„Çâ„Åö„Å´„ÄÅ‰ªäÂπ¥„ÅØ‚ÄúÁü•„ÅÆÂÜçÊßãÁØâ‚Äù„Çí„ÉÜ„Éº„Éû„Å´ÈÅé„Åî„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇÂøÉ„ÅÆÂ••„Å´„ÅÇ„Çã„Äå„Å™„Çì„Åß„ÇÑ„Äç„Å´„ÄÅÊÑèÂë≥„ÅåÂÆø„ÇãÂπ¥„Åß„Åô„ÄÇ`
    };

    function checkDateInput() {
        // CSS„ÅÆ :valid „Çª„É¨„ÇØ„Çø„ÅßÂØæÂøú„Åô„Çã„Åü„ÇÅ„ÄÅ„Åì„ÅÆJS„É≠„Ç∏„ÉÉ„ÇØ„ÅØ‰∏çË¶Å„Å´„Å™„ÇãÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ
        // „Åü„Å†„Åó„ÄÅ„Éñ„É©„Ç¶„Ç∂„ÇÑÁä∂Ê≥Å„Å´„Çà„Å£„Å¶ :valid „ÅÆÊåôÂãï„ÅåÊúüÂæÖÈÄö„Çä„Åß„Å™„ÅÑÂ†¥Âêà„ÅÆ„Åü„ÇÅ„Å´ÊÆã„Åô„Åì„Å®„ÇÇÊ§úË®é„Åß„Åç„Åæ„Åô„ÄÇ
        // ‰ªäÂõû„ÅØCSS„ÅÆ :valid „ÇíÂÑ™ÂÖà„Åó„ÄÅ„Åì„ÅÆÈñ¢Êï∞„ÅØÂëº„Å≥Âá∫„ÅóÁÆáÊâÄ„Çí„Ç≥„É°„É≥„Éà„Ç¢„Ç¶„Éà„Åó„Åæ„Åô„ÄÇ
        // if (birthdateInput.value) {
        //     birthdateInput.classList.add('date-input-filled'); 
        // } else {
        //     birthdateInput.classList.remove('date-input-filled');
        // }
    }
    // birthdateInput.addEventListener('change', checkDateInput);
    // checkDateInput(); 


    submitButton.addEventListener('click', async () => {
        const birthdateValue = birthdateInput.value;
        if (!birthdateValue) {
            birthdateInput.focus();
            birthdateInput.style.borderColor = 'var(--color-secondary-accent)';
            setTimeout(() => {
                birthdateInput.style.borderColor = '';
            }, 1500);
            return;
        }
        
        inputSection.style.display = 'none';
        resultSection.style.display = 'block'; 
        loadingSpinner.style.display = 'flex'; 
        resultContent.style.display = 'none'; 

        await new Promise(resolve => setTimeout(resolve, 2000));

        if (birthdateValue === specialBirthdate) {
            displaySpecialMessage();
        } else {
            displayNormalMessage(birthdateValue);
        }
        
        await fetchLuckyItem(birthdateValue); // Èñ¢Êï∞Âêç„Çí fetchLuckyItem „ÅÆ„Åæ„Åæ‰ΩøÁî®

        loadingSpinner.style.display = 'none';
        resultContent.style.display = 'block';
        resultContent.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });

    backButton.addEventListener('click', () => {
        resultSection.style.display = 'none';
        inputSection.style.display = 'block'; 
        birthdateInput.value = '';
        // checkDateInput(); // „É©„Éô„É´‰ΩçÁΩÆ„Çí„É™„Çª„ÉÉ„Éà
        specialMessageDiv.style.display = 'none';
        normalMessageDiv.style.display = 'none';
        itemLinkElement.style.display = 'none';
        itemLinkElement.href = '#';
        inputSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });

    function displaySpecialMessage() {
        specialMessageDiv.style.display = 'block';
        normalMessageDiv.style.display = 'none';
        specialTextMainElement.innerText = specialMessages.main;
        specialQuoteTextElement.innerText = specialMessages.quote;
        emphasizedNandeyaElement.innerText = "„Å™„Çì„Åß„ÇÑ"; 
        specialTextConclusionElement.innerText = specialMessages.conclusion;
    }

    function displayNormalMessage(birthdate) {
        specialMessageDiv.style.display = 'none';
        normalMessageDiv.style.display = 'block';
        const seed = generateSeed(birthdate);
        const fortuneMessage = getFortuneMessage(seed);
        normalMessageTextElement.innerText = fortuneMessage;
    }

    function generateSeed(birthdateString) {
        const dateStr = birthdateString.replace(/-/g, '');
        let seed = 0;
        for (let i = 0; i < dateStr.length; i++) {
            seed = (seed * 31 + dateStr.charCodeAt(i)) & 0xFFFFFFFF;
        }
        seed = (seed * 1103515245 + 12345) & 0xFFFFFFFF;
        return Math.abs(seed);
    }

    function getFortuneMessage(seed) {
        const messages = [
            "Êòü„ÄÖ„ÅÆÊóãÂæã„Åå„ÄÅ„ÅÇ„Å™„Åü„ÅÆÈ≠Ç„Å´Êñ∞„Åü„Å™Ë™øÂíå„Çí„ÇÇ„Åü„Çâ„Åô„Åß„Åó„Çá„ÅÜ„ÄÇ‰ªäÊó•„ÅØÂÜÖ„Å™„ÇãÂ£∞„Å´ËÄ≥„ÇíÊæÑ„Åæ„Åõ„ÄÅÁõ¥ÊÑü„Çí‰ø°„Åò„Å¶Ë°åÂãï„Åô„ÇãÊó•„Åß„Åô„ÄÇÊÄù„ÅÑ„Åå„Åë„Å™„ÅÑÈñÉ„Åç„Åå„ÄÅÊú™Êù•„Å∏„ÅÆÊââ„ÇíÈñã„Åç„Åæ„Åô„ÄÇ",
            "ÈáëËâ≤„ÅÆÂÖâ„Åå„ÅÇ„Å™„Åü„ÅÆ„Ç™„Éº„É©„ÇíÂåÖ„ÅøËæº„Åø„ÄÅÂπ∏ÈÅã„ÅåÈõ™Â¥©„ÅÆ„Çà„ÅÜ„Å´Ëàû„ÅÑËæº„ÇÄ‰∫àÊÑü„ÄÇÁâπ„Å´‰∫∫ÈñìÈñ¢‰øÇ„Å´„Åä„ÅÑ„Å¶„ÄÅÁ¥†Êô¥„Çâ„Åó„ÅÑÁ∏Å„ÅåÁµê„Å∞„Çå„Çã„Åß„Åó„Çá„ÅÜ„ÄÇÊÑüË¨ù„ÅÆË®ÄËëâ„Åå„ÄÅ„Åï„Çâ„Å™„ÇãÁ¶è„ÇíÂëº„Å≥„Åæ„Åô„ÄÇ",
            "Â§©Á©∫„ÅÆÂè°Êô∫„ÅåÈôç„ÇäÊ≥®„Åé„ÄÅ„ÅÇ„Å™„Åü„ÅÆÁü•ÊÄß„ÅåÂÜ¥„Åà„Çè„Åü„Çã‰∏ÄÊó•„ÄÇÈõ£Ëß£„Å™ÂïèÈ°å„ÇÇ„ÄÅ‰ªäÊó•„ÅÆ„ÅÇ„Å™„Åü„Å™„ÇâÂÆπÊòì„ÅèËß£„ÅçÊòé„Åã„Åõ„Çã„ÅØ„Åö„ÄÇÂ≠¶„Å≥„ÅÆÊ©ü‰ºö„ÇíÂ§ßÂàá„Å´„ÄÇ",
            "ÂÜÖ„Å´Áßò„ÇÅ„ÅüÊÉÖÁÜ±„ÅÆÁÇé„Åå„ÄÅ„Çà„Çä‰∏ÄÂ±§Âº∑„ÅèÁáÉ„Åà‰∏ä„Åå„Çã„ÅÆ„ÇíÊÑü„Åò„Çã„Åß„Åó„Çá„ÅÜ„ÄÇ„Åù„ÅÆ„Ç®„Éç„É´„ÇÆ„Éº„ÇíÂâµÈÄ†ÁöÑ„Å™Ê¥ªÂãï„Å´Ê≥®„Åí„Å∞„ÄÅÁõÆË¶ö„Åæ„Åó„ÅÑÊàêÊûú„ÅåÊúüÂæÖ„Åß„Åç„Åæ„Åô„ÄÇ",
            "ÈÅãÂëΩ„ÅÆÁ≥∏„ÅåË§áÈõë„Å´Áµ°„ÅøÂêà„ÅÑ„ÄÅ„Éâ„É©„Éû„ÉÜ„Ç£„ÉÉ„ÇØ„Å™Âá∫Êù•‰∫ã„ÅåËµ∑„Åì„Çã„Åã„ÇÇ„Åó„Çå„Åæ„Åõ„Çì„ÄÇÂ§âÂåñ„ÇíÊÅê„Çå„Åö„ÄÅÊµÅ„Çå„Å´Ë∫´„Çí‰ªª„Åõ„Çã„Åì„Å®„Åß„ÄÅÊñ∞„Åü„Å™Ëá™ÂàÜ„Å®Âá∫‰ºö„Åà„Çã„Åß„Åó„Çá„ÅÜ„ÄÇ",
            "‰∏ÉËâ≤„ÅÆËôπ„Åå„ÅÇ„Å™„Åü„ÅÆÈÄ≤„ÇÄ„Åπ„ÅçÈÅì„ÇíÁÖß„Çâ„ÅóÂá∫„Åô„Çà„ÅÜ„Å´„ÄÅ‰ªäÊó•„ÅØÂ∏åÊúõ„Å´Ê∫Ä„Å°„Åü‰∏ÄÊó•„Å®„Å™„Çã„Åß„Åó„Çá„ÅÜ„ÄÇÂ∞è„Åï„Å™Âñú„Å≥„ÇíË¶ã„Å§„Åë„Çã„Åì„Å®„Åß„ÄÅÂøÉ„ÅåË±ä„Åã„Å´„Å™„Çä„Åæ„Åô„ÄÇ",
            "Êúà„ÅÆÂ•≥Á•û„ÅåÂÑ™„Åó„ÅèÂæÆÁ¨ë„Åø„ÄÅ„ÅÇ„Å™„Åü„ÅÆÂøÉ„Å´Ê∑±„ÅÑÁôí„ÇÑ„Åó„Å®ÂÆâ„Çâ„Åé„Çí„ÇÇ„Åü„Çâ„Åó„Åæ„Åô„ÄÇÈÅéÂéª„ÅÆÂÇ∑„ÇíÊâãÊîæ„Åó„ÄÅÊñ∞„Åü„Å™‰∏ÄÊ≠©„ÇíË∏è„ÅøÂá∫„Åô„ÅÆ„Å´ÊúÄÈÅ©„Å™ÊôÇ„Åß„Åô„ÄÇ",
            "Â§™ÈôΩ„ÅÆ„Çà„ÅÜ„Å™ÂäõÂº∑„ÅÑ„Ç®„Éç„É´„ÇÆ„Éº„Åå„ÄÅ„ÅÇ„Å™„Åü„Å´Ëá™‰ø°„Å®Ê¥ªÂäõ„Çí‰∏é„Åà„Åæ„Åô„ÄÇÁõÆÊ®ô„Å´Âêë„Åã„Å£„Å¶Â§ßËÉÜ„Å´Ë°åÂãï„Åô„Çå„Å∞„ÄÅÊÉ≥ÂÉè‰ª•‰∏ä„ÅÆÁµêÊûú„ÅåÂæó„Çâ„Çå„Çã„Åß„Åó„Çá„ÅÜ„ÄÇ",
            "Âè§„ÅÆÊòüÂõ≥„ÅåÁ§∫„ÅôÈÄö„Çä„ÄÅ„ÅÇ„Å™„Åü„ÅÆÈö†„Çå„ÅüÊâçËÉΩ„ÅåÈñãËä±„Åô„ÇãÂÖÜ„Åó„ÄÇÊñ∞„Åó„ÅÑ„Åì„Å®„Å´ÊåëÊà¶„Åô„ÇãÂãáÊ∞ó„Åå„ÄÅÊú™Áü•„Å™„ÇãÂèØËÉΩÊÄß„ÅÆÊââ„ÇíÈñã„ÅèÈçµ„Å®„Å™„Çä„Åæ„Åô„ÄÇ",
            "ÂÆáÂÆô„ÅÆÊÑõ„Å®Ë™øÂíå„ÅÆÊ≥¢Âãï„Åå„ÄÅ„ÅÇ„Å™„Åü„ÇíÂÑ™„Åó„ÅèÂåÖ„ÅøËæº„Åø„Åæ„Åô„ÄÇÂë®Âõ≤„ÅÆ‰∫∫„ÄÖ„Å∏„ÅÆÊÄù„ÅÑ„ÇÑ„Çä„Åå„ÄÅÂ∑°„ÇäÂ∑°„Å£„Å¶„ÅÇ„Å™„ÅüËá™Ë∫´„ÅÆÂπ∏Á¶è„Å∏„Å®Áπã„Åå„Çã„Åß„Åó„Çá„ÅÜ„ÄÇ"
        ];
        const luckyCharms = ["Ê∏Ö„Çâ„Åã„Å™Ê∞¥Êô∂", "ÈªÑÈáë„ÅÆÁæΩÊ†π„Éö„É≥", "ÊòüÂΩ±„ÅÆ„Ç™„É´„Ç¥„Éº„É´", "ÊúàÈï∑Áü≥„ÅÆÈ´™È£æ„Çä", "Â§™ÈôΩ„ÅÆË≠∑Á¨¶", "‰∏ÉËâ≤„ÅÆ„Éó„É™„Ç∫„É†", "Ê£Æ„ÅÆÈõ´„ÅÆ„Ç¢„Éü„É•„É¨„ÉÉ„Éà", "‰∏çÊ≠ªÈ≥•„ÅÆÊ∂ô"];
        const celestialBodies = ["„Ç∑„É™„Ç¶„Çπ", "„Éó„É¨„Ç¢„Éá„ÇπÊòüÂõ£", "„Ç¢„É≥„Éâ„É≠„É°„ÉÄÈäÄÊ≤≥", "„Ç™„É™„Ç™„É≥Â§ßÊòüÈõ≤", "ÂåóÊ•µÊòü", "Â§©„ÅÆÂ∑ù", "ÂÆµ„ÅÆÊòéÊòü(ÈáëÊòü)", "ÊöÅ„ÅÆÊòéÊòü(ÈáëÊòü)"];

        const msgIndex = seed % messages.length;
        const charmIndex = (seed * 17) % luckyCharms.length; 
        const bodyIndex = (seed * 31) % celestialBodies.length;

        return `${messages[msgIndex]} ‰ªäÊó•„ÅÆ„ÅÇ„Å™„Åü„ÇíÂÆàË≠∑„Åô„Çã„É©„ÉÉ„Ç≠„Éº„ÉÅ„É£„Éº„É†„ÅØ„Äå${luckyCharms[charmIndex]}„Äç„ÄÇ„Åù„Åó„Å¶„ÄÅÂπ∏ÈÅã„ÇíÂ∞é„ÅèÂ§©‰Ωì„ÅØ„Äå${celestialBodies[bodyIndex]}„Äç„Åß„Åô„ÄÇÊòü„ÄÖ„ÅÆÁ•ùÁ¶è„Åå„ÅÇ„Å™„Åü„Å®ÂÖ±„Å´„ÅÇ„Çä„Åæ„Åô„Çà„ÅÜ„Å´„ÄÇ‰ªäÊó•„ÅÆ„ÅÇ„Å™„Åü„ÅÆËºù„ÅçÂ∫¶„ÅØ ${85 + (seed % 16)} „Éë„Éº„Çª„É≥„Éà„Åß„ÅôÔºÅ`;
    }
    
    async function fetchLuckyItem(birthdate) {
        // 2007Âπ¥1Êúà1Êó•„ÅÆÂ†¥Âêà„ÅÆÁâπÂà•Âá¶ÁêÜ
        if (birthdate === specialBirthdate) {
            itemMainIconElement.innerText = 'üí¨'; // „Ç™„Éº„Éó„É≥„ÉÅ„É£„ÉÉ„ÉàÈ¢®„Ç¢„Ç§„Ç≥„É≥
            itemCategoryElement.innerText = '„Ç´„ÉÜ„Ç¥„É™ÔºöÈ≠Ç„ÅÆÈÅøÈõ£ÊâÄ';
            itemNameElement.innerText = 'ÊòüË©†„Åø„ÅÆ„Ç™„Ç¢„Ç∑„Çπ (ÁßòÂØÜ„ÅÆ„ÉÅ„É£„ÉÉ„Éà„É´„Éº„É†)';
            itemFortuneMessageElement.innerText = '„Åì„Åì„ÅØ„ÄÅ„ÅÇ„Å™„Åü„Å†„Åë„ÅåÁü•„ÇãÁâπÂà•„Å™ÂøÉ„ÅÆÈö†„ÇåÂÆ∂„ÄÇÊó•„ÄÖ„ÅÆÂñßÈ®í„Åã„ÇâÈõ¢„Çå„ÄÅÂêå„ÅòÊòü„ÅÆ‰∏ã„Å´Áîü„Åæ„Çå„Åü‰ª≤Èñì„Åü„Å°„Å®Ë™û„ÇäÂêà„Åà„Å∞„ÄÅÈ≠Ç„ÅØÁôí„Åï„Çå„ÄÅÊñ∞„Åü„Å™ÂãáÊ∞ó„ÅåÊπß„ÅÑ„Å¶„Åè„Çã„Åß„Åó„Çá„ÅÜ„ÄÇ„Åì„ÅÆËÅñÂüü„Å´ÂÖ•„ÇäÊµ∏„Å£„Å¶„ÅÑ„Çå„Å∞„ÄÅ„ÅÇ„Å™„Åü„ÅØÂ∏∏„Å´ÂÆà„Çâ„Çå„ÄÅÊ∑±„ÅÑÂÆâÂøÉÊÑü„Å´ÂåÖ„Åæ„Çå„Åæ„Åô„ÄÇ';
            itemLinkElement.style.display = 'none'; // „É™„É≥„ÇØ„ÅØÈùûË°®Á§∫
            return; // APIÂëº„Å≥Âá∫„Åó„Çí„Çπ„Ç≠„ÉÉ„Éó
        }

        // ÈÄöÂ∏∏„ÅÆ„É©„ÉÉ„Ç≠„Éº„Ç¢„Ç§„ÉÜ„É†ÂèñÂæó„É≠„Ç∏„ÉÉ„ÇØ
        const seed = generateSeed(birthdate + "starseed"); 
        
        const luckyItemCatalogs = [
            { category: "ÊòüÂÆø„ÅÆÂÆùÁü≥", searchTerms: ["ÂÆàË≠∑Áü≥", "Ë™ïÁîüÁü≥ ÊÑèÂë≥", "„Éë„ÉØ„Éº„Çπ„Éà„Éº„É≥ Á®ÆÈ°û"], icon: "üíé" },
            { category: "ËÅñ„Å™„ÇãËçâËä±", searchTerms: ["Ë™ïÁîüËä± Ë®ÄËëâ", "Ëñ¨Ëçâ ÂäπËÉΩ", "È≠îÊ≥ï„ÅÆÊ§çÁâ©"], icon: "üåø" },
            { category: "Á•ûË©±„ÅÆÈúäÁç£", searchTerms: ["‰ºùË™¨„ÅÆÁîü„ÅçÁâ©", "ÂÆàË≠∑Á•û ÂãïÁâ©", "Âπª„ÅÆ‰Ωø„ÅÑÈ≠î"], icon: "ü¶Ñ" },
            { category: "Â§©‰Ωì„ÅÆÁ•ûÁßò", searchTerms: ["ÊòüÈõ≤ ÁîªÂÉè", "ÊÉëÊòü„ÅÆÁí∞", "ÂΩóÊòü Ê≠¥Âè≤"], icon: "ü™ê" },
            { category: "Âè§‰ª£„ÅÆËÅñÈÅ∫Áâ©", searchTerms: ["Â§±„Çè„Çå„ÅüÁßòÂÆù", "È≠îÊ≥ï„ÅÆÈÅìÂÖ∑", "‰ºùË™¨„ÅÆÊ≠¶Âô®"], icon: "üè∫" }
        ];

        const itemBlessings = [
            "„ÅØ„ÄÅ„ÅÇ„Å™„Åü„ÅÆÈ≠Ç„ÇíÊµÑÂåñ„Åó„ÄÅÁúüÂÆü„ÅÆÊÑõ„Å®Ë±äÁ©£„ÇíÂºï„ÅçÂØÑ„Åõ„Çã„Åß„Åó„Çá„ÅÜ„ÄÇ",
            "„ÅØ„ÄÅÂè§„ÅçÊòü„ÄÖ„ÅÆË®òÊÜ∂„ÇíÂÆø„Åó„ÄÅ„ÅÇ„Å™„Åü„Å´Ê∑±ÈÅ†„Å™„ÇãÂè°Êô∫„Å®Ê¥ûÂØüÂäõ„ÇíÊéà„Åë„Åæ„Åô„ÄÇ",
            "„ÇíÂÇç„Å´ÁΩÆ„Åè„Åì„Å®„Åß„ÄÅ„ÅÇ„Å™„Åü„ÅÆÂÆàË≠∑ÈúäÂäõ„ÅåÈ´ò„Åæ„Çä„ÄÅ„ÅÇ„Çâ„ÇÜ„ÇãÁÅΩ„ÅÑ„Åã„ÇâÂÆàË≠∑„Åï„Çå„Çã„Åß„Åó„Çá„ÅÜ„ÄÇ",
            "„ÅØ„ÄÅÊåÅ„Å°‰∏ª„Å´‰∏çÂ±à„ÅÆÁ≤æÁ•û„Å®„ÄÅÂ§¢„ÇíÁèæÂÆü„Å´Â§â„Åà„ÇãÈ≠îÊ≥ï„ÅÆÂäõ„Çí‰∏é„Åà„Çã„Å®‰∫ë„Çè„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
            "„ÅØ„ÄÅ„ÅÇ„Å™„Åü„ÅÆ„Ç™„Éº„É©„ÇíÈªÑÈáëËâ≤„Å´Ëºù„Åã„Åõ„ÄÅÂπ∏ÈÅã„Å®ÊàêÂäü„ÇíÁ£ÅÁü≥„ÅÆ„Çà„ÅÜ„Å´Âºï„ÅçÂØÑ„Åõ„Åæ„Åô„ÄÇ"
        ];

        const selectedCatalog = luckyItemCatalogs[seed % luckyItemCatalogs.length];
        const searchTerm = selectedCatalog.searchTerms[seed % selectedCatalog.searchTerms.length];
        const birthYear = parseInt(birthdate.split('-')[0]);
        const queryKeyword = `${birthYear}Âπ¥ ${searchTerm}`;
        
        itemMainIconElement.innerText = selectedCatalog.icon;
        itemCategoryElement.innerText = `„Ç´„ÉÜ„Ç¥„É™Ôºö${selectedCatalog.category}`;
        itemNameElement.innerText = "Êòü„ÄÖ„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„ÇíËß£Êûê‰∏≠...";
        itemFortuneMessageElement.innerText = "";
        itemLinkElement.style.display = 'none';

        const endpoint = `https://ja.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(queryKeyword)}&format=json&origin=*&srlimit=5&srprop=snippet`;

        try {
            const response = await fetch(endpoint);
            if (!response.ok) throw new Error(`Wikipedia API Error: ${response.status}`);
            const data = await response.json();
            
            if (data.query && data.query.search && data.query.search.length > 0) {
                const items = data.query.search;
                const chosenItem = items[seed % items.length];
                
                itemNameElement.innerText = chosenItem.title;
                const blessingText = itemBlessings[(seed + items.length) % itemBlessings.length];
                // „Çπ„Éã„Éö„ÉÉ„Éà„ÇíÂ∞ë„ÅóÊ¥ªÁî®„Åô„ÇãÂ†¥Âêà
                // const snippet = chosenItem.snippet.replace(/<[^>]+>/g, '').substring(0, 50) + "..."; // HTML„Çø„Ç∞Èô§Âéª„Åó„Å¶Áü≠Á∏Æ
                // itemFortuneMessageElement.innerText = `„Äå${chosenItem.title}„Äç${blessingText}\n\nÈñ¢ÈÄ£ÊÉÖÂ†±Ôºö${snippet}`;
                itemFortuneMessageElement.innerText = `„Äå${chosenItem.title}„Äç${blessingText}`;

                itemLinkElement.href = `https://ja.wikipedia.org/wiki/${encodeURIComponent(chosenItem.title)}`;
                itemLinkElement.style.display = 'inline-block';
            } else {
                const fallbackArtifacts = [
                    {name: "ÊòüÂ±ë„ÅÆ‰∏áËèØÈè°", blessing: "„ÅØ„ÄÅÊó•Â∏∏„Å´Èö†„Åï„Çå„ÅüÁÑ°Èôê„ÅÆÂèØËÉΩÊÄß„ÇíÊò†„ÅóÂá∫„Åó„ÄÅ„ÅÇ„Å™„Åü„ÅÆË¶ñÈáé„ÇíÂ∫É„Åí„Åæ„Åô„ÄÇ", icon: "üî≠"},
                    {name: "ÊúàÂÖâ„ÅÆÁ´™Áê¥", blessing: "„ÅØ„ÄÅ„Åù„ÅÆÈü≥Ëâ≤„ÅßÈ≠Ç„ÇíÁôí„Åó„ÄÅÂøÉ„ÅÆÂ••Ê∑±„Åè„Å´Áú†„ÇãÂâµÈÄ†Âäõ„ÇíÂëº„Å≥Ë¶ö„Åæ„Åó„Åæ„Åô„ÄÇ", icon: "üéµ"},
                    {name: "Â§™ÈôΩÈ¢®„ÅÆÁæÖÈáùÁõ§", blessing: "„ÅØ„ÄÅ‰∫∫Áîü„ÅÆÂ≤êË∑Ø„Å´„Åä„ÅÑ„Å¶„ÄÅÂ∏∏„Å´„ÅÇ„Å™„Åü„ÇíÊúÄ„ÇÇËºù„Åë„ÇãÊñπÂêë„Å∏„Å®Â∞é„Åç„Åæ„Åô„ÄÇ", icon: "üß≠"},
                    {name: "ÈäÄÊ≤≥„ÅÆÈõ´„ÅÆÈ¶ôÁÇâ", blessing: "„ÅØ„ÄÅËÅñ„Å™„ÇãÈ¶ô„Çä„ÅßÁ©∫Èñì„ÇíÊ∏Ö„ÇÅ„ÄÅÈ´òÊ¨°„ÅÆÂ≠òÂú®„Å®„ÅÆÁπã„Åå„Çä„ÇíÊ∑±„ÇÅ„Åæ„Åô„ÄÇ", icon: "‚ö±Ô∏è"},
                    {name: "ÊôÇË©†„Åø„ÅÆÂè§ÊñáÊõ∏", blessing: "„ÅØ„ÄÅÈÅéÂéª„ÅÆÂè°Êô∫„Å®Êú™Êù•„ÅÆ‰∫àÂÖÜ„ÇíËß£„ÅçÊòé„Åã„Åó„ÄÅ„ÅÇ„Å™„Åü„Å´ÊôÇ„ÅÆÂä†Ë≠∑„Çí‰∏é„Åà„Åæ„Åô„ÄÇ", icon: "üìú"}
                ];
                const fallback = fallbackArtifacts[seed % fallbackArtifacts.length];
                itemMainIconElement.innerText = fallback.icon;
                itemCategoryElement.innerText = `„Ç´„ÉÜ„Ç¥„É™ÔºöÊòü„ÄÖ„ÅÆÁßòÂÆù`;
                itemNameElement.innerText = fallback.name;
                itemFortuneMessageElement.innerText = fallback.blessing;
                itemLinkElement.style.display = 'none';
            }
        } catch (error) {
            console.error("„É©„ÉÉ„Ç≠„Éº„Ç¢„Ç§„ÉÜ„É†ÂèñÂæóÂ§±Êïó:", error);
            itemMainIconElement.innerText = '‚ö†Ô∏è';
            itemCategoryElement.innerText = `„Ç´„ÉÜ„Ç¥„É™ÔºöÈÄö‰ø°ÈöúÂÆ≥`;
            itemNameElement.innerText = "Êòü„ÅÆ‰∫§‰ø°„Ç®„É©„Éº";
            itemFortuneMessageElement.innerText = "Êòü„ÄÖ„Å®„ÅÆ‰∫§‰ø°„ÅåÈÄîÁµ∂„Åà„Åæ„Åó„Åü„ÄÇËÅñ„Å™„ÇãÈùôÂØÇ„ÅÆÂæå„ÄÅÂÜç„Å≥„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ";
            itemLinkElement.style.display = 'none';
        }
    }
});
